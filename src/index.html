<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>to do</title>
    <link rel="stylesheet" href="./output.css">
</head>

<body>
    <header class="flex justify-between p-2 bg-primary">
        <span class="relative flex items-center">
            <input type="text" placeholder="recherche"
                class="bg-blure placeholder:pl-1 placeholder:text-white md:w-60 ">
            <svg class="absolute end-0 " xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960"
                width="22px" fill="#ffffff">
                <path
                    d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
            </svg>
        </span>
        <div class="bg-blure p-2">
            <svg id="add" xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px"
                fill="#ffffff">
                <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
            </svg>
        </div>
    </header>
    <!-- all the cards -->
    <section class="grid grid-cols-1 grid-rows-3 md:grid-cols-3 md:grid-rows-1 place-items-center mt-3">
        <div class="relative card ">
            <div class="flex justify-between">
                <h1 class="text-title font-bold text-lg pl-1">To do</h1>
                <p
                    class="text-title font-bold absolute top-0 right-0 bg-red-600 rounded-full w-6 h-6 text-center lg:w-8 lg:h-8 lg:text-lg ">
                    4</p>
            </div>
             <div
                class="bg-white w-64 mx-auto p-2 border-b-2 border-red-600 rounded-sm mt-5 flex flex-col justify-between md:w-52 lg:w-72 xl:w-[350px]" id="TodoCard">
                
            </div> 
        </div>
        <div class="relative card mt-1">
            <div class="flex justify-between">
                <h1 class="text-title font-bold text-lg pl-1">doing</h1>
                <p
                    class="text-title font-bold absolute top-0 right-0 bg-orange-600 rounded-full w-6 h-6 text-center lg:w-8 lg:h-8   lg:text-lg">
                    4</p>
            </div>
            <div
                class="bg-white w-64 mx-auto p-2 border-b-2 border-orange-600 rounded-sm mt-5 flex justify-between md:w-52 lg:w-72 xl:w-[350px]"  id="DoingCard">
               
            </div>
        </div>
        <div  class="relative card mt-1">
            <div class="flex justify-between">
                <h1 class="text-title font-bold text-lg pl-1">done</h1>
                <p
                    class="text-title font-bold absolute top-0 right-0 bg-green-600 rounded-full w-6 h-6 text-center lg:w-8 lg:h-8 lg:text-lg">
                    4</p>
            </div>
            <div
                class="bg-white w-64 mx-auto p-2 border-b-2 border-green-600 rounded-sm mt-5 flex justify-between md:w-52 lg:w-72 xl:w-[350px]" id="DoneCard">
               
            </div>
        </div>
    </section>
    <!-- add modal -->
    <div id="modal"
        class="bg-white hidden border border-title w-60 h-auto rounded-lg fixed top-72  left-1/2 transform -translate-x-1/2 -translate-y-1/2 md:top-96">
        <form class="flex flex-col m-3 ">
            <label for="titre">titre</label>
            <input type="text" class=" border bg-slate-200" id="titre">
            <label for="description">description</label>
            <textarea class=" border bg-slate-200 resize-none" id="description"></textarea>
            <label for="status">status</label>
            <div class="flex flex-col">
                <div class="flex items-center gap-2">
                    <label for="toDo" class="w-24">to do</label>
                    <input type="radio" name="status" id="toDo" value="to do">
                </div>
                <div class="flex items-center gap-2">
                    <label for="doing" class="w-24">doing</label>
                    <input type="radio" name="status" id="doing" value="doing">
                </div>
                <div class="flex items-center gap-2">
                    <label for="done" class="w-24">done</label>
                    <input type="radio" name="status" id="done" value="done">
                </div>
            </div>
            <label for="date">Date d'ech√©ance</label>
            <input type="date" name="date" id="date">
            <label for="Priorite">Priorite</label>
            <div class="flex flex-col">
                <div class="flex items-center gap-2">
                    <label for="P1" class="w-24">P1</label>
                    <input type="radio" name="Priorite" id="P1" value="p1">
                </div>
                <div class="flex items-center gap-2">
                    <label for="P2" class="w-24">P2</label>
                    <input type="radio" name="Priorite" id="P2" value="p2">
                </div>
                <div class="flex items-center gap-2">
                    <label for="P3" class="w-24">P3</label>
                    <input type="radio" name="Priorite" id="P3" value="p3">
                </div>
            </div>
            <div class="flex mt-2 gap-2">
                <button class="bg-green-500 p-2 rounded-md text-white font-medium" id="submit">submit</button>
                <button class="bg-red-500 p-2 rounded-md text-white" id="cancel">cancel</button>
            </div>
        </form>
    </div>
    <script>
        const modal = document.getElementById("modal");
        const submit = document.getElementById("submit");
        const cancel = document.getElementById("cancel");
        const openModal = document.getElementById("add");
        const all = [];
        var id = 1;
        openModal.addEventListener("click", function () {
            modal.classList.remove("hidden");
        })
        function showById(id){
            console.log('test'); //debug
            
            const storeData = localStorage.getItem("info");
            if(storeData){
                console.log("first condition in showById"); //debug
                
                const data = JSON.parse(storeData);
                console.log("this is the parsed daTA inside the showByID functin ", data);  //debug
                
                let result = data.find(obj=> obj.id === id);
                console.log(result)
            }
        }
       
        function show (){
            
            console.log("test");
            const storeData = localStorage.getItem("info");
            const cards = {
                TodoCard : document.getElementById("TodoCard"),
                DoingCard : document.getElementById("DoingCard"),
                DoneCard : document.getElementById("DoneCard")
            }
            //empty all the divs to avoid duplicate the data inside the div with the data come from the localStorage
            Object.values(cards).forEach(card => card.innerHTML = "")
            // const TodoCard = 
            // const DoingCard = document.getElementById("DoingCard");
            // const DoneCard = document.getElementById("DoneCard");
            if(storeData){
                console.log("condition");
                console.log("store data " + storeData);
                
                const data = JSON.parse(storeData);
                console.log("this is data ",data);
                data.forEach((item) => {  
                    console.log(item)
                        console.log("data.status = ",item.status) 
                        console.log("second condition");
                        const newDiv = document.createElement("div");
                        newDiv.innerHTML = `
                        <div class="flex justify-between ">                        
                            <h2 class="text-BigTitle font-semibold ${item.priority == 'p1' ? 'text-red-600' : item.priority == 'p2' ? ' text-orange-700' : item.priority == 'p3' ? 'text-green-600' : ''} ">${item.titre}</h2>
                            <svg  class=" w-4" xmlns="http://www.w3.org/2000/svg" height="22px" viewBox="0 -960 960 960" width="22px"
                            fill="#5f6368">
                            <path
                            d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z" />
                            </svg>
                        </div>
                        <div class="flex justify-between">
                            <p>${item.date}</p>
                            <p>${item.priority}</p>
                        </div>
                            
                        `
                        // assign a function to svg 
                        newDiv.querySelector('svg').onclick = function(){
                            showById(item.id) // to show specifique object when i click the svg 
                        };
                        newDiv.classList.add('flex','justify-between','flex-col','mt-2')
                        if(item.status == "to do"){          
                        TodoCard.append(newDiv);
                        console.log("true");
                        }
                         if (item.status == "doing"){
                            DoingCard.append(newDiv)
                            console.log("doing true");
                        }
                        if(item.status == "done"){
                            DoneCard.append(newDiv);
                            console.log("done true")
                        }
                    });
            }
            else{
                console.log("user todos not found in local storage")
            }
        }
       
        // open the modal and get the data from input and pass the data to localStorage
        document.getElementById("submit").addEventListener("click", function(event){
  event.preventDefault()
});
        submit.addEventListener("click", function (event) {
            const titre = document.getElementById("titre").value;
            const description = document.getElementById("description").value;
            const status = document.querySelector('input[name="status"]:checked');
            const date = document.getElementById("date").value;
            const Priorite = document.querySelector('input[name="Priorite"]:checked');

            all.push({ "id": id, "titre": titre, "descrip": description, "status": status ? status.value : '', "date": date, "priority": Priorite ? Priorite.value : '' })
            id++
            localStorage.setItem("info",JSON.stringify(all))

            show();
            modal.classList.add("hidden");
        })
        // to get the data from localstorage 
     
        // to close the modal
        cancel.addEventListener("click", function () {
            modal.classList.add("hidden");
        })
// show() //intiall the page with the previous data
    </script>
</body>

</html>